package com.nestor.hcl.slideshow {	import com.nestor.tools.phpQuery;	import flash.display.MovieClip;	import flash.events.*;	import flash.net.*;	import flash.display.BitmapData;	import flash.display.Bitmap;	import flash.display.Loader;	import flash.display.Stage;			public class showList extends tweenable {		var p:phpQuery		var topic:Number;		var _ico:Bitmap;		var swfX:XMLList;		var padding,stH,stW,lX,lY,lW,lH:Number;		public var oneShow=true;				var www,query,byTopic,topicName,thisIcon:String;				public function showList(_cfg:XML) {			alpha=0;			mouseEnabled=false;			addEventListener(Event.ADDED_TO_STAGE, init);			topic=_cfg.myTopic.@id;			www=_cfg.net.www.toString();			query=_cfg.net.query.toString();			byTopic=_cfg.net.getByTopic.toString();			topicName=_cfg.topics.topic.(@id == topic).@name.toString();			thisIcon=www+_cfg.net.templates+topic+"/"+_cfg.net.icon;						padding=Number(_cfg.list.listitem.@padding);			lW=Number(_cfg.list.listitem.@width);			lH=Number(_cfg.list.listitem.@height);			stH=_cfg.topics.topic.(@id == topic).@H;			stW=_cfg.topics.topic.(@id == topic).@W;			swfX = _cfg.topics.topic.(@id == topic).swf.slideshow;			trace("query = "+www+query+byTopic+topic+", topicName="+topicName);								}				private function init(e:Event):void		{												lX=(stW-lW)/2			lY=20;			initICO();		}				private function initICO():void		{			var req:URLRequest=new URLRequest(thisIcon);			var ldr:Loader=new Loader();			ldr.cacheAsBitmap=true;			ldr.contentLoaderInfo.addEventListener(Event.COMPLETE, initPHP);			ldr.load(req);		}				private function initPHP(e:Event):void		{			var ldr:Loader = Loader(e.target.loader);            _ico = ldr.content as Bitmap;			_ico.width=_ico.height=lH;			var q:phpQuery = new phpQuery(www+query+byTopic+topic);			q.addEventListener(Event.COMPLETE, pLoaded);		}				private function pLoaded(e:Event):void		{						e.target.removeEventListener(Event.COMPLETE, pLoaded);			var X:XML = (topic == 1) ? addSWF(e.target.vars) : e.target.vars;						var totalH = (lH+padding)*X.slideshow.length();			var thisOff = (stH-totalH)/2;			var i:Number=0;			this.show();			oneShow = (X.slideshow.length() == 1);			if(oneShow == false){				for each(var ss:XML in X.slideshow)				{					var tmpIco:Bitmap = new Bitmap(_ico.bitmapData.clone());										var tmpI:listItem=new listItem(ss,tmpIco);					var tmpY:Number =i*lH;										tmpI.resizeTo(lW,lH);							tmpI.x=lX;					tmpI.y=(tmpY+(padding*i))+thisOff;					this.addChild(tmpI);					trace("Adding ListItem: @"+tmpI.x+"/"+tmpI.y+" : "+lW+"x"+lH+" i="+i);					i++;				}			}else{				var fakeSS:XML =new XML( X.slideshow);				var fakeIco:Bitmap = new Bitmap(_ico.bitmapData.clone());				var fakeI:listItem=new listItem(fakeSS,fakeIco);				addChild(fakeI);				fakeI.dispatchEvent(new Event(MouseEvent.MOUSE_UP,true));			}					}				private function addSWF(_X:XML):XML		{						_X.appendChild(swfX);						return _X;								}				/*public function hide():void		{			//trace("Hiding");			this.alpha=0;		}				public function show():void		{			//trace("Hiding");			this.alpha=0;		}*/	}	}