package com.nestor.hcl.slideshow {	import com.nestor.tools.phpQuery;	import flash.events.*;	import flash.display.Sprite;	import flash.display.Loader;	import flash.net.URLRequest;	import flash.utils.getDefinitionByName;		public class show extends tweenable{		public var showName:String;		private var id:Number;		private var topicI:Number;		private var www:String ;		private var query:String;		private var getByID:String;		private var media:String;		private var bg:String;		private var templates:String;		private var url:String;		private var slideShow:Array=[];		private var stageW,stageH:Number;		private var thisSlide:Number=0;		private var btnC:XML;		private var btnL:nav;		private var btnR:nav;						public function show(_cfg:XML,_i:Number) {			id=_i;			setup(_cfg)			addEventListener(Event.ADDED_TO_STAGE, init);						btnL= new nav();			btnR= new nav();		}				private function init(e:Event):void{			removeEventListener(Event.ADDED_TO_STAGE, init);			stageW=stage.stageWidth;			stageH=stage.stageHeight;			addEventListener("loadingHtml", loading);					}		private function setup(_cfg:XML):void		{			topicI=_cfg.myTopic.@id;			www=_cfg.net.www;			query=_cfg.net.query;			getByID=_cfg.net.getByID;			templates=_cfg.net.templates;			bg=_cfg.net.bg_img;			url=www+query+getByID+id.toString();																		btnC = new XML( _cfg.topics.topic.(@id == topicI).btn);			trace("Full url: "+url);			var q:phpQuery = new phpQuery(url);			q.addEventListener(Event.COMPLETE, showLoaded);											}										private function showLoaded(e:Event):void		{			trace("Loaded");			var xData:XML = e.target.vars as XML;			showName = xData.name;			var aSlides:Array = [];			for each (var _X:XML in xData.slide)			{				aSlides.push(_X.toString());				trace("Pushed Array"+_X.@id);			}						buildShow(aSlides);		}				private function buildShow(a:Array):void		{			var isFirst:Boolean = true;						for each (var s:String in a){				slideShow.push(buildSlide(s, isFirst));				isFirst = false;				trace(">>>>>>>>>>**********<<<<<<<<<<");				trace(s);							}						addEventListener("readyToPlay", ready);			addChildAt(slideShow[thisSlide],0);			slideShow[thisSlide].born();					}				private function buildSlide(s:String, f:Boolean):*		{						var tmpSlide = new slide(s,stageW,stageH);			return tmpSlide;					}						function loading(e:Event):void		{			trace("Loading, Please Wait");		}				function ready(e:Event):void		{			setupBtns(btnC);						trace("Ready to play");		}				private function setupBtns(c:XML):void		{			var type:String=c.@type.toString();						var classObj:Object = getDefinitionByName( type );												btnL = new classObj();			btnR = new classObj();						btnL.x=Number(c.@LX);			btnL.y=Number(c.@Y);			btnR.x=Number(c.@RX);			btnR.y=Number(c.@Y);						addChild(btnL);			addChild(btnR);						btnL.btnMode="hide";			btnR.btnMode="next";						btnR.addEventListener(MouseEvent.MOUSE_UP, btnHandler);			btnL.addEventListener(MouseEvent.MOUSE_UP, btnHandler);		}				private function btnHandler(e:Event):void		{			var m:String=e.target.btnMode;			(m == "done") ? exit() : flip(m);		}				private function exit():void		{			this.hide();		}				private function flip(m:String):void		{			if (m!="hide"){				var killSlide:Function = function (e:Event):void				{					slideShow[thisSlide].born();					var sl:slide = e.target as slide;					sl.removeEventListener(Event.COMPLETE, killSlide);					removeChild(sl);				}				var d:Number = (m == "next") ? 1 : -1;				var old:Number = thisSlide;				//thisSlide = (thisSlide+d)%slideShow.length;				thisSlide = checkSlide(thisSlide+d);								if(thisSlide!=old){					trace("flip to "+(thisSlide+1)+" of "+slideShow.length);					addChildAt(slideShow[thisSlide],0);					slideShow[old].die();					slideShow[old].addEventListener(Event.COMPLETE, killSlide);				}			}		}				private function checkSlide(s:Number):Number		{						if (s == 0)			{				trace("targetSlide is "+s+"which is first slide");								btnL.btnMode="hide";				btnR.btnMode="next";				return s;			}						else if (s == slideShow.length-1){				trace("targetSlide is "+s+"which is last slide");								btnL.btnMode="back";				btnR.btnMode="done";				return s;			}			else{				btnL.btnMode="back";				btnR.btnMode="next";				return s;			}		}				/*private function killSlide(e:Event):void		{			var sl:slide = e.target as slide;			sl.removeEventListener(Event.COMPLETE, killSlide);			removeChild(sl);		}*/									}	}/*<www>http://www.kittynchoke.com/monadnock/fslides/</www><query>show_query.php</query><getbyID>?id=</getbyID><getbyTopic>?topic=</getbyTopic><media>media/</media>*/